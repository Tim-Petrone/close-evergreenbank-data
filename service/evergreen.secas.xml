<?xml version="1.0" encoding="UTF-8"?>
<secas xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-eca-2.1.xsd">
    <seca id="OrderCustomerProcessingLoanEstimatePdf" service="update#mantle.order.OrderHeader" when="post-service" priority="97">
        <condition><expression>statusChanged &amp;&amp; statusId == 'OrderCustomerProcessing'</expression></condition>
        <actions>
            <service-call name="close.AgreementServices.check#AgreementExist" in-map="[orderId: orderId, agreementTypeEnumId: 'MkAgrLoanEstimate']" out-map="result"/>
            <if condition="!result.exist">
                <service-call name="close.agreements.FillablePdfServices.fill#FillablePdf" in-map="[orderId: orderId, agreementTypeEnumId: 'MkAgrLoanEstimate']"/>
                <service-call name="close.EmailServices.send#OrderStoreEmailAllApplicants" in-map="[
                    orderId:orderId, emailTypeEnumId:'PsetIndirectLoanEstimate', roleTypeIds: ['PrimaryApplicant', 'CoApplicant']
                ]"/>
            </if>
        </actions>
    </seca>
</secas>